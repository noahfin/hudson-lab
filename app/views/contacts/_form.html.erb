<%= form_for(@contact, html: { multipart: true}) do |form| %>
<!-- start of form to add new contact -->
<div class="panel-body">
  <div class="form-horizontal">
    <div class="row">
      <div class="col-lg-6">
        <%= render 'layouts/messages' if !flash.empty? %>
        <%= content_tag :div, class: "form-group #{'has-danger' if has_error?(@contact, :name)}" do %>
          <div class="col-xl-12">
            <label for="name" class="bmd-label-floating">Contacts Name</label><%= form.text_field :name, id: :contact_name, class: 'form-control' %>
          </div>
        <% end %>
        <div class="form-group">
          <div class="col-xl-12">
            <label for="company" class="bmd-label-floating">Contacts Company</label><%= form.text_field :company, id: :contact_company, class: 'form-control '%>
          </div>
        </div>
        <%= content_tag :div, class: "form-group #{'has-danger' if has_error?(@contact, :name)}" do %>
          <div class="col-xl-12">
            <label for="email" class="bmd-label-floating">Contacts Email</label><%= form.text_field :email, id: :contact_email, class: 'form-control rounded-0 '  %>
          </div>
         <% end %>
        <div class="form-group">
          <div class="col-xl-12">
            <label for="phone" class="bmd-label-floating">Contacts Phone</label><%= form.text_field :phone, id: :contact_phone, class: 'form-control rounded-0 ' %>
          </div>
        </div>
        <div class="form-group">
          <div class="col-xl-12">
            <label for="cell" class="bmd-label-floating">Contacts Cell</label><%= form.text_field :cell, id: :contact_cell, class: 'form-control rounded-0 '%>
          </div>
        </div>
        <div class="form-group">
          <div class="col-xl-12">
            <label for="address" class="bmd-label-floating">Address</label><%= form.text_area :address, id: :contact_address, class: 'form-control rounded-0', row: '3' %>
          </div>
        </div>
      <div class="col-xl-12">
        <div class="row">
          <div class="form-inline">

          <div class="input-group"><%= form.submit @contact.new_record? ? "Save" : "Update", class: "btn btn-outline-success  ml-3"  %>
          </div>
            <div class="input-group  ml-3">
                <a href="/contacts/" class="btn btn-outline-danger  ml-3">Cancel</a>
            </div>
          </div>
        </div>
      </div>
      </div>
      <div class="col-xl-6 mt-4">
        <div class="row">
          <div class="col-xl-4  mr-0 pr-0">
            <div class="fileinput fileinput-new" data-provides="fileinput">
              <div class="fileinput-new thumbnail" style="max-width: 150px; max-height: 150px;"><%= image_tag @contact.avatar.present? ? @contact.avatar.url(:thumb) : 'http://placehold.it/150x150', class: "media-object" %>
              </div>
              <div class="fileinput-preview fileinput-exists thumbnail" style="max-width: 200px; max-height: 150px;"><%= image_tag @contact.avatar.present? ? @contact.avatar.url(:thumb) : 'http://placehold.it/150x150', class: "media-object" %>
              </div>
              <div class="text-center">
                <span class="btn btn-default btn-file">
                  <span class="fileinput-new">Choose Photo</span>
                  <span class="fileinput-exists">Change</span><%= form.file_field :avatar %>
                </span>
                <a href="#" class="btn btn-default fileinput-exists" data-dismiss="fileinput">Remove</a>
              </div>
            </div>
          </div>
          <div class="col-xl-8  ml-0 pl-4">
            <div class="form-group "><% attr = {prompt: "Select Group"} %><% attr[:selected] = session[:selected_group_id].to_i if session[:selected_group_id] %>
              <div class="row">
                <div class="col-xl-6  ml-0  pl-0 pb-1">
                  <label for="cell" class="bmd-label-floating">Pick a Group</label><%= form.collection_select :group_id, current_user.groups.uniq, :id, :name, attr,{required: true, class: " selectpicker", "data-style" => "select-with-transition", "data-size" => Group.count } %>
                </div>
                <div class="col-xl-6 ml-0 pl-0 pb-1"><% attr = {prompt: "Select related users"} %><% attr[:selected] = current_user.id.to_i if current_user.id %>
                  <label for="cell" class="bmd-label-floating" title="You need to select yourself anyone else who needs the contact." rel="tooltip">Pick users</label><%= form.collection_select :user_id, User.all, :id, :first_name, attr,{required: true, :multiple => true, class: " selectpicker", "data-style" => "select-with-transition", "data-size" => User.count } %>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12">
            <div class=" pl-0 mt-4 pr-2">
              <a href="#" id="add-group-btn" class="btn btn-outline-info btn-block mb-4 pr-4 mr-0">Add Group</a>
            </div>
          </div>
          </div>
        <div class="form-group " id="add-new-group" style="display: none;">
          <div class="row mt-4">
            <div class="col-xl-4 mr-0 pr-2  " >
              <button class="btn btn-outline-info col-lg-12 mr-0" type="button" data-toggle="collapse" data-target="#add-users-group" aria-expanded="false" aria-controls="add-users-group">
           Share &nbsp;&nbsp; <i class="fa fa-user-circle-o"></i>
            </button>
            </div>
            <div class=" col-md-6">
              <div class="input-group pl-0">
                <div class="col-xl-12">
                  <div class="row pl-0">
                    <div class="col-xl-10 pl-3 mb-4">
                      <label for="address" class="bmd-label-floating">New Group Name</label>
                      <input type="text" name="new_group" id="new_group" class="form-control ml-0">
                      </div>
                      <div class="col-xl-2 ">
                        <span class="input-group-btn mr-0 ml-2">
                          <button type="button" class="btn btn-fab btn-round btn-info" id="save-new-group">
                            <i class="material-icons">input</i>
                          </button>
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="collapse" id="add-users-group">
              <div class="btn-group"><% User.all.each do |user| %><%  next if !user.first_name  %>
                <div class="togglebutton form-check-inline">
                  <label>
                    <input type="checkbox" checked="true" value=<%="#{user.id}" if user.first_name %> class="users-for-new-group"/>
                      <span class="toggle"></span>
                      <span class="text-light"><%= user.first_name + ' ' + user.last_name  if user.first_name  && user.last_name %>
                      </span>
                    </label>
                  </div><% end %>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="panel-footer">

  </div>
</div><% end %>
